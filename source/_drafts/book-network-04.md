---
title: 网络原理-运输层
date: 2020-05-31 16:06:15
categories: 网络原理
---

## 作用
- **为应用进程之间提供端到端的逻辑通信**（网络层的作用是：为主机之间提供逻辑通信）
- 对收到的报文进行差错检测
- 提供面向连接（TCP）和无连接（UDP）的服务

> 端口标识了应用进程

## TCP和UDP
- TCP：面向连接的服务
- UDP：无连接的服务

### 端口
传输层端口用一个16位端口号进行标志
> 端口号只是为了标识本计算机应用层中的各个进程<br>常见端口
>
> - FTP： 21
> - TELNET：23
> - SMTP：25
> - DNS：53
> - HTTP：80

### TCP
#### 特点
- 只能是一对一的连接
- 可靠交付
- 全双工通信（）
- 字节流

#### 如何连接？
TCP连接的端点叫做套接字（socket（IP，端口号））

### UDP
- 支持一对一 ，一对多，多对一， 多对多
- 尽最大努力交付
- 首部开销小（8个字节）
- 面向报文（？）


## 可靠传输
- 确认
- 超时重传
- TCP报文段： 序号，确认号，窗口，SYH，ACK，FIN
- 协议
	- 停止等待协议：效率抵消
	- 连续ARQ协议：流水线工作方式
		- 发送窗口
			- 受接收方接受能力的影响（rwnd）——流量控制
			- 网络拥塞情况的影响（cwnd）——拥塞控制

### 流量控制(rwnd)
> rwnd是TCP报文段首部中的窗口字段，可靠传输结合发送窗口

- 持续计时器（零窗口探测）

### 拥塞控制(cwnd)
出现条件： 对资源需求的总和 > 可用资源

- 慢开始（指数增长）
- 拥塞避免（线性增长）（只要发送方没有按时收到确认）
- 快重传
- 快恢复


#### 慢开始门限状态变量ssthresh
- 当 cwnd < ssthresh 时，使用慢开始算法。
- 当 cwnd > ssthresh 时，停止使用慢开始算法而改用拥塞避免算法。
- 当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞避免算
法
#### 当网络出现拥塞时
1. 只要发送方判断没有按时收到确认时，就把**慢开始的门限**，设为出现拥塞时的发送窗口的一般（最小等于2）
2. 然后把**cwnd重设为1**，执行慢开始

#### 快重传
> 快重传和快恢复都是成对出现的

要求接收方每收到一个失序的报文段后就立即发出重复确认

三个重复确认

#### 快恢复 
当发送端收到连续三个重复的确认时，就执行“乘法减小”算法，把慢开始**门限 ssthresh 减半**，但**拥塞窗口 cwnd现在不设置为 1，而是设置为慢开始门限 ssthresh 减半后的数值**，然后开始执行拥塞避免算法（“线性增大”）

## 连接管理
### 1.建立连接（三次握手）
SYN=1 表示要建立连接
seq=x x是序号

### 2.数据传输（控制）
### 3.释放连接（四次握手）